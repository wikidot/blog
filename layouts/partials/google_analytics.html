{{ if and .Site.Params.enableGoogleAnalytics (eq hugo.Environment "production") }}
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied',
    'personalization_storage': 'denied',
    'functionality_storage': 'denied',
    'security_storage': 'granted'
  });
  
  gtag('js', new Date());
  gtag('config', '{{ .Site.Params.googleAnalyticsID }}', { 
    'anonymize_ip': true,
    'allow_google_signals': false,
    'allow_ad_personalization_signals': false
  });
  
  window.enableAnalytics = function() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
    console.log('Analitiche attivate');
  }
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.Params.googleAnalyticsID }}"></script>
{{ end }}